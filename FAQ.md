# FITNESS アプリ Q&A（発表用）

発表時に想定される質問と回答をまとめています。

---

## 技術的な質問

### Q1: なぜReactやVueではなく、素のHTML/CSS/JSで作ったのですか？

**A:** チームメンバーの技術スタック的に、HTML/CSS/JSの方が簡単に開発できると判断したためです。

**ただし、実際に開発してみて...**

ReactやVueを使った方がよかったと感じています。

| 素のHTML/CSS/JSの課題 | Reactなら解決できた |
|---------------------|-------------------|
| ページ間で状態が共有できない | SPAで状態維持 |
| リアルタイム通知がページ遷移で途切れる | 全ページで即時反映 |
| 同じUIを各ページで重複して書く | コンポーネント再利用 |
| コードの再利用性が低い | 状態管理がシンプル |

**次回はReactで開発したいと考えています。**

---

### Q2: データベースは何を使っていますか？

**A:** Firebase Cloud Firestoreを使用しています。

- **選んだ理由:**
  - リアルタイム同期が簡単（onSnapshot）
  - サーバーレスで運用コストが低い
  - 認証（Firebase Auth）との連携が容易
  - オフライン対応が組み込まれている

- **コレクション構成:**
  - `users` - ユーザー情報（名前、アバター、フレンドリスト）
  - `trainings` - トレーニング記録（種目、時間、スコア）
  - `challenges` - 対戦データ（参加者、スコア、状態）

---

### Q3: 認証はどのように実装していますか？

**A:** Firebase Authenticationのメール/パスワード認証を使用しています。

- セッション管理はFirebaseが自動で行う
- ログイン状態はブラウザに永続化される
- 各ページで`requireAuth()`を呼び出して未認証ユーザーをリダイレクト

---

### Q4: リアルタイム通知はどう実現していますか？

**A:** FirebaseのonSnapshotリスナーを使用しています。

```javascript
// チャレンジの変更を監視
db.collection('challenges')
  .where('opponentId', '==', userId)
  .onSnapshot((snapshot) => {
    // 新しいチャレンジが来たら通知表示
  });
```

- フレンド追加、チャレンジ受信、マイルストーン達成時にトースト通知
- ページ遷移すると再接続が必要（SPAではないため）

---

### Q5: 画像アップロードはどこに保存していますか？

**A:** Cloudinaryという画像CDNサービスを使用しています。

- **理由:** 無料枠が大きい、自動最適化、高速配信
- アップロード上限: 5MB
- アップロードプリセットで自動リサイズ

---

### Q6: デフォルトアバターはどう生成していますか？

**A:** DiceBear APIを使用しています。

```
https://api.dicebear.com/7.x/adventurer/svg?seed=ユーザー名
```

- シード値に基づいて一意のアバターを生成
- 登録画面ではランダムシードで毎回異なるアバターを表示
- SVG形式で軽量かつ高品質

---

### Q7: スコア計算のロジックを教えてください

**A:**
```
消費カロリー = トレーニング時間(分) × 種目別カロリー係数
スコア = 消費カロリー × 1.5
```

例: ランニング30分
- カロリー: 30分 × 10kcal/分 = 300kcal
- スコア: 300 × 1.5 = **450pt**

種目ごとのカロリー係数は運動強度に基づいて設定しています（4〜12 kcal/分）。

---

### Q8: セキュリティ対策は何をしていますか？

**A:**
1. **Firestoreセキュリティルール** - 自分のデータのみ編集可能
2. **XSS対策** - ユーザー入力は`escapeHtml()`でエスケープ
3. **認証チェック** - 全ページでログイン状態を確認
4. **入力バリデーション** - メール形式、パスワード長さなどをチェック

---

### Q9: レスポンシブ対応はしていますか？

**A:** はい、モバイルファーストで設計しています。

- 基本幅: 480px（スマホ最適化）
- PC版: 2カラムレイアウトに自動切り替え
- 下部ナビゲーションはモバイルで固定表示
- タッチフレンドリーなボタンサイズ（50px以上）

---

### Q10: 使用しているライブラリ・APIは？

| 名前 | 用途 |
|------|------|
| Firebase Auth | ユーザー認証 |
| Cloud Firestore | データベース |
| Cloudinary | 画像アップロード |
| DiceBear API | デフォルトアバター生成 |
| Chart.js | スコアグラフ描画 |
| Lucide Icons | UIアイコン |
| Google Fonts | Poppinsフォント |

---

## アプリの使い方に関する質問

### Q11: アカウント登録の流れは？

**A:**
1. 登録画面でアバターが自動生成される（気に入らなければリロードで変更可）
2. ユーザー名、メール、パスワードを入力
3. 登録ボタンを押すとホーム画面へ
4. ユーザーID（例: `username#1234`）が自動発行される

---

### Q12: フレンドを追加するには？

**A:**
1. フレンドページで相手のユーザーIDを入力（例: `taro#5678`）
2. 検索ボタンを押す
3. 相手のプロフィールが表示されたら「追加」ボタン
4. 双方のフレンドリストに追加される

※自分のユーザーIDはプロフィールページまたはフレンドページで確認・コピーできます

---

### Q13: 対戦（チャレンジ）の始め方は？

**A:**
1. フレンドページでフレンドを選択
2. 「チャレンジ」ボタンを押す
3. 対戦期間を設定（1〜30日）
4. 相手に通知が届く
5. 相手が「受ける」を押すと対戦開始

---

### Q14: 対戦中のスコアはどう計算される？

**A:** 対戦期間中に記録したトレーニングのスコアが自動で集計されます。

- リアルタイムでスコアが更新される
- ホーム画面とフレンド画面で現在のスコアを確認可能
- 1000/2000/3000/5000/10000ポイント達成時に通知

---

### Q15: 対戦の勝敗はどう決まる？

**A:** 対戦期間終了時点でスコアが高い方が勝利です。

- 同点の場合は引き分け
- 結果は「完了した対戦」セクションに記録される

---

### Q16: トレーニングの種目は何がある？

**A:** 12カテゴリ、100種類以上のトレーニングがあります。

| カテゴリ | 例 |
|---------|-----|
| 腕 | ダンベルカール、プッシュアップ |
| 足 | スクワット、ランジ |
| 腹筋 | クランチ、プランク |
| 背中 | デッドリフト、懸垂 |
| 胸 | ベンチプレス、ディップス |
| 全身 | バーピー、ケトルベル |
| 有酸素 | ランニング、HIIT、縄跳び |
| 格闘技 | ボクシング、キックボクシング |
| 柔軟 | ヨガ、ストレッチ |
| 水中 | 水泳、アクアビクス |
| スポーツ | サッカー、バスケ、テニス |

---

### Q17: プロフィールで何ができる？

**A:**
- **アバター変更** - 画像をアップロード
- **ユーザー名変更** - 編集ボタンから変更可能
- **統計確認** - 累計スコア、今日のスコア、トレーニング回数、消費カロリー
- **グラフ表示** - 週間/月間のスコア推移
- **履歴確認** - 過去のトレーニング記録一覧

---

### Q18: 通知はどんな時に来る？

**A:**
- フレンドが追加された時
- チャレンジを受けた時
- 対戦中にマイルストーン達成時（1000pt, 2000pt, 3000pt, 5000pt, 10000pt）

※通知は画面右上にトースト形式で表示され、5秒後に自動で消えます

---



### Q21: 工夫した点・こだわった点は？

**A:**
1. **ゲーミフィケーション** - スコア、ランキング、対戦でモチベーション維持
2. **デザイン** - 黒×ゴールドの高級感あるUI、グラスモーフィズム
3. **ユーザー体験** - リアルタイム通知、スムーズなアニメーション
4. **ID** - フレンド追加を簡単に（例: `user#1234`）

---

### Q22: 今後の改善予定は？

**A:**
- React/Vueへの移行（SPA化でリアルタイム通知を強化）
- PWA対応（オフライン機能、プッシュ通知）
- トレーニングリマインダー機能
- ソーシャルシェア機能
- より詳細な統計分析

---

### Q23: 苦労した点は？

**A:**

#### 1. マルチページアプリでのリアルタイム通知の実現
ページごとにHTMLファイルが分かれているため、ページ遷移するとJavaScriptの状態がリセットされてしまう。onSnapshotリスナーを各ページで再設定する必要があった。

#### 2. Firebaseセキュリティルールの設計
```javascript
// 課題: 誰でも他人のデータを読み書きできてしまう
// 解決: ルールで自分のデータのみ操作可能に制限
match /users/{userId} {
  // 読み取り: ログイン済みなら誰でもOK（ランキング表示のため）
  allow read: if request.auth != null;

  // 作成: 自分のドキュメントのみ
  allow create: if request.auth.uid == userId;

  // 更新: 自分のデータ or フレンド追加のみ
  allow update: if request.auth.uid == userId ||
    request.resource.data.diff(resource.data).affectedKeys().hasOnly(['friends']);
}

match /trainings/{trainingId} {
  // 自分のトレーニングのみ作成・編集可能
  allow create: if request.auth.uid == request.resource.data.userId;
  allow update, delete: if request.auth.uid == resource.data.userId;
}
```
**苦労した点:** フレンド追加時に相手のfriendsフィールドも更新する必要があり、「自分以外のデータは編集不可」というルールと矛盾。`affectedKeys().hasOnly(['friends'])`で特定フィールドのみ許可する方法を見つけるまで時間がかかった。

#### 3. チャレンジのスコア集計ロジック
```javascript
// 課題: 対戦期間中のスコアだけを集計する必要がある
async function calculateChallengeScore(userId, startDate, endDate) {
  const snap = await db.collection('trainings')
    .where('userId', '==', userId)
    .where('timestamp', '>=', startDate)  // 開始日以降
    .where('timestamp', '<=', endDate)    // 終了日以前
    .get();

  let total = 0;
  snap.forEach(doc => total += doc.data().score);
  return total;
}
```
**苦労した点:**
- Firestoreは複合クエリにインデックスが必要 → Firebase Consoleでインデックス作成
- タイムスタンプの比較で日本時間とUTCのズレ → Firestore Timestampを統一使用
- リアルタイム更新時の再集計タイミング → 1秒ごとのポーリングで対応

#### 4. レスポンシブデザインの調整
```css
/* 課題: モバイルとPCで全く違うレイアウトが必要 */

/* モバイル（デフォルト）: 1カラム */
.container {
  max-width: 480px;
  padding: 16px;
}

/* PC（768px以上）: 2カラム */
@media (min-width: 768px) {
  .page-wrapper {
    flex-direction: row;
  }
  .left-section { width: 35%; }
  .right-section { width: 65%; }
}
```
**苦労した点:**
- ボトムナビゲーションの位置固定（`position: fixed`と`padding-bottom`の調整）
- 入力フォームのアイコン配置（`position: absolute`でinput内に配置）
- グラスモーフィズム効果がSafariで効かない → `-webkit-backdrop-filter`を追加

---

## デモ時の注意点

1. **インターネット接続必須** - Firebaseを使用しているため
2. **ブラウザはChrome推奨** - 一部アニメーションの互換性
3. **デモ用アカウント** - 事前に2つ以上のアカウントを用意しておくと対戦デモができる
4. **画面共有時** - モバイル表示（480px幅）でデモすると見やすい

---

## クイックリファレンス

| 機能 | 場所 |
|------|------|
| ログイン/登録 | `/login.html`, `/register.html` |
| ホーム | `/home.html` |
| トレーニング記録 | `/training.html` |
| ランキング | `/ranking.html` |
| フレンド・対戦 | `/friends.html` |
| プロフィール | `/profile.html` |

---

*このドキュメントは発表・質疑応答用に作成されました*
